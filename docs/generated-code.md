# Working With Generated Code

Guide to using the TypeScript SOAP clients and types generated by wsdl-tsc.

See [README](../README.md) for quick start and [Concepts](concepts.md) for type modeling details.

## Client Construction

```typescript
import soap from "soap";
import { Weather } from "./src/services/weather/client.js";

const client = new Weather({
  source: "https://example.com/WeatherService?wsdl",
  security: new soap.WSSecurity("username", "password")
});
```

The `source` parameter accepts a URL or local file path to the WSDL.

## Calling Operations

```typescript
const forecast = await client.GetCityForecastByZIP({
  ZIP: "10001"
});

console.log(forecast.GetCityForecastByZIPResult.Success);
console.log(forecast.GetCityForecastByZIPResult.ForecastResult);
```

Operations without input still require an empty object:

```typescript
const info = await client.GetWeatherInformation({});
console.log(info.GetWeatherInformationResult.WeatherDescriptions);
```

## Attributes and Text Content

When an element has both attributes and text content, use the $value convention:

```typescript
const price = {
  currencyCode: "USD",
  $value: "123.45"
};
```

See [Concepts](concepts.md) for details on the flattening model and $value convention.

## Working With Arrays

Repeated elements are automatically typed as arrays:

```typescript
interface ForecastReturn {
  Forecast: Forecast[];  // maxOccurs > 1
}
```

## Type Safety

All operations and types are fully typed:

```typescript
const result: GetCityWeatherByZIPResponse = await client.GetCityWeatherByZIP({
  ZIP: "10001"
});

result.GetCityWeatherByZIPResult.Temperature;
```

Autocomplete and type checking work across all generated interfaces.

## Gateway Route Handlers

When generating a Fastify gateway (`--gateway-dir`), each SOAP operation gets a fully typed route handler. The handler imports the request type from the client, uses Fastify's `Body: T` generic for type inference, and wraps the SOAP response in a standard envelope.

```typescript
import type { FastifyInstance } from "fastify";
import type { GetCityForecastByZIP } from "../../client/types.js";
import schema from "../schemas/operations/getcityforecastbyzip.json" with { type: "json" };
import { buildSuccessEnvelope } from "../runtime.js";

export async function registerRoute_v1_weather_getcityforecastbyzip(fastify: FastifyInstance) {
  fastify.route<{ Body: GetCityForecastByZIP }>({
    method: "POST",
    url: "/get-city-forecast-by-zip",
    schema,
    handler: async (request) => {
      const client = fastify.weatherClient;
      const result = await client.GetCityForecastByZIP(request.body as GetCityForecastByZIP);
      return buildSuccessEnvelope(result.response);
    },
  });
}
```

Key features of the generated handlers:

- **`Body: T` generic** — Fastify infers `request.body` type from the route generic, enabling IDE autocomplete and compile-time checks
- **JSON Schema validation** — the `schema` import provides Fastify with request/response validation at runtime, before the handler runs
- **Envelope wrapping** — `buildSuccessEnvelope()` wraps the raw SOAP response in the standard `{ status, message, data, error }` envelope

See [Gateway Guide](gateway-guide.md) for the full architecture and [CLI Reference](cli-reference.md) for generation flags.
